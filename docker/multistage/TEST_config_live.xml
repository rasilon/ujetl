<?xml version="1.0" encoding="iso-8859-1"?>
<CopyingApp>
  <hardLimitSeconds>360000</hardLimitSeconds>
  <nRowsToLog>10000</nRowsToLog>
  <blockSize>1000</blockSize>
  <source>
    <dsn>jdbc:postgresql://testdb:5432/test</dsn>
    <username>test</username>
    <password>test</password>
    <networkTimeout>600000</networkTimeout>
  </source>
  <dest>
    <dsn>jdbc:postgresql://testdb:5432/test</dsn>
    <username>test</username>
    <password>test</password>
  </dest>
  <jobs>
    <job>
      <name>test</name>
      <key>select coalesce(-1,max(id),-1) as key from dest</key>
      <select>
          select
            id,
            test_int,
            test_text,
            test_ts
          from
          public.source where id > ?::bigint</select>
      <insert>
          insert into public.dest(
            id,
            test_int,
            test_text,
            test_ts
        )values(
            ?::bigint,
            ?::integer,
            ?::text,
            ?::timestamp with time zone
        )ON CONFLICT(id) DO UPDATE
        set
            test_int = EXCLUDED.test_int,
            test_text = EXCLUDED.test_text,
            test_ts = EXCLUDED.test_ts
        WHERE
            dest.test_int = EXCLUDED.test_int
            OR dest.test_text = EXCLUDED.test_text
            OR dest.test_ts = EXCLUDED.test_ts
      </insert>
    </job>
  </jobs>
</CopyingApp>
